# HTML ファイルを contentful に登録

コマンドを実行して以下を行います。

- html で使用するアセットを登録
- html を page 登録

## アセット登録

- html ファイルに含まれるアセットタグ src のパラメータからアセットファイルを検索する
- アップロード済のファイルであれば保持している contentful の url 情報に html を書き換えます。
- 登録がない場合、アセットファイルを`contentful > Media`にアップロードを行う
- html ファイル内の アセットタグのアセットのパスを contentful の url に書き換える

### 対象となるアセットタグ

| 該当ファイル | アセットタグ              | アセットのパス |
| ------------ | ------------------------- | -------------- |
| 画像ファイル | `<img>`                   | src の値       |
| 音声ファイル | `<audio>`                 | src の値       |
| 動画ファイル | `<video>`                 | src の値       |
| css ファイル | `<link rel="stylesheet">` | href の値      |

### アップロードする際のパラメータ指定

| key         | 備考                                       |                                  |
| ----------- | ------------------------------------------ | -------------------------------- |
| Title       | アップロードしたファイルのパスを除いたもの |                                  |
| Description | アップロードしたファイルのパスを含めたもの | アップロード済かどうか判定に利用 |
| File        | アップロードしたファイル                   |                                  |

上記をそれぞれの HTML ファイルで繰り返します。
書き換え処理が終わった HTML は「html を page として登録」で contentful に登録する

### 対象外のアセット

- アセットの参照がないもの(例：src="http...."の画像など、)

### 重複アップロードの対応

同じファイルを使用している場合は既存の contentful の登録内容を再利用します。

## html を page として登録

- 上記で書き換えを行った後にディレクトリごとに HTML を Contful に PAGE として登録します。

contentful のパラメータは以下のようにします。

| key      | 登録内容                                         |
| -------- | ------------------------------------------------ |
| pagePath | html を格納している、ディレクトリを"/"として登録 |
| head     | html の`<head>`タグの内容                        |
| body     | html の`<body>`タグの内容                        |
| script   | html の`<script>`タグの内容                      |

## 登録した html を gatsby で表示する

- contentful の page をクエリで取得します。
- ブラウザで開いている url と pagePath が一致するページを検索してデータを取得し、gatsby.js で利用できる形式に変換して表示します。
- `data-component={compnent名}`属性を持ったタグを component として表示します。
- component の`props`は html `data-props={props情報}`にセットした props を利用
- props の必須項目がない場合はエラー表示

### ニュースのコンポーネント

infomation に登録したニュースを表示・確認ができます。
[コンポーネントの仕様](../../Gatsby/Component/newslist.md)
