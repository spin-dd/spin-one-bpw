# HTML ファイルを contentful に登録

コマンドを実行して以下を行います。

- html で使用するアセットを登録
- html を page 登録

## アセット登録

- html ファイルに含まれるアセットタグ src のパラメータからアセットファイルを検索する
- アップロード済のファイルであれば保持している contentful の url 情報に html を書き換える。
- 登録がない場合、アセットファイルを`contentful > Media`にアップロードを行う
- html ファイル内の アセットタグをアップロードファイルを表示するコンポーネントに書き換える
- `/data/contentful`フォルダにアップロードした際のパラメータ情報をファイルに保存する。

### 対象となるアセットタグ

| 該当ファイル | アセットタグ | アセットのパス |
| ------------ | ------------ | -------------- |
| 画像ファイル | `<img>`      | src の値       |

### アップロードする際のパラメータ指定

| key         | 備考                                                                                               |                                    |
| ----------- | -------------------------------------------------------------------------------------------------- | ---------------------------------- |
| Title       | アップロードするファイル名                                                                         |                                    |
| Description | アップロードするファイルのハッシュ値                                                               | アップロード済かどうか判定に利用   |
| Id          | アップロードするファイルのファイルパス（処理時に指定するディレクトリからの相対パスでのハッシュ値） | ファイルを一意に特定するために利用 |
| File        | アップロードするファイル                                                                           |                                    |

上記をそれぞれの HTML ファイルで繰り返す。
書き換え処理が終わった HTML は「html を page として登録」で contentful に登録する

### 対象外のアセット

- アセットの参照がないもの(例：src="http...."の画像など、)

### 重複アップロードの対応

`/data`フォルダににアップロードした際のパラメータ情報を保存します。
同じファイルを使用している場合は既存の contentful の登録内容を再利用します。

## html を page として登録

- 上記で書き換えを行った後にディレクトリごとに HTML を Contful に PAGE として登録します。
- 対象ディレクトリ`/HTML`のディレクトリごとに HTMLファイルを を Contful に PAGE として登録します。
contentful のパラメータは以下のようにします。

| key      | 登録内容                                         |
| -------- | ------------------------------------------------ |
| pagePath | pagePathの定義に従う |
| head     | html の`<head>`タグの内容                        |
| body     | html の`<body>`タグの内容                        |

### pagePathの定義

{ファイルのディレクトリのパス}+{ファイル名から`.html`を除いたもの}
ファイルのディレクトリのパス：htmlファイルのディレクトリパスのうち`/spin-one/HTML`以降のディレクトリのパスを登録 `/spin-one/HTML/news/company_news.html`であれば`/news/`として登録
ファイル名から`.html`を除いたもの: `company_news.html`であれば`company_news`とする 例外として`index.html`は`""`とする

## 登録した html を gatsby で表示する

- contentful の page をクエリで取得します。
- ブラウザで開いている url と pagePath が一致するページを検索してデータを取得し、gatsby.js で利用できる形式に変換して表示します。
- `data-component={compnent名}`属性を持ったタグを component として表示します。
- component の`props`は html `data-props={props情報}`にセットした props を利用
- props の必須項目がない場合はエラー表示

### ニュースのコンポーネント

infomation に登録したニュースを表示・確認ができます。
[コンポーネントの仕様](../../Gatsby/Component/newslist.md)
